Index: withme_backend/src/main/java/com/javalab/student/service/QuestionService.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.javalab.student.service;\r\n\r\nimport com.javalab.student.dto.ChoiceDTO;\r\nimport com.javalab.student.dto.QuestionDTO;\r\nimport com.javalab.student.entity.Question;\r\nimport com.javalab.student.entity.SurveyTopic;\r\nimport com.javalab.student.entity.UserSelectedTopics;\r\nimport com.javalab.student.repository.QuestionRepository;\r\nimport com.javalab.student.repository.UserSelectedTopicsRepository;\r\nimport lombok.RequiredArgsConstructor;\r\nimport org.springframework.stereotype.Service;\r\nimport org.springframework.transaction.annotation.Transactional;\r\n\r\nimport java.util.List;\r\nimport java.util.Optional;\r\nimport java.util.stream.Collectors;\r\n\r\n/**\r\n * \uD83D\uDCCC ì§ˆë¬¸ ì„œë¹„ìŠ¤ (ë¬´ë£Œ & ìœ ë£Œ ë¬¸ì§„)\r\n * - ì„¤ë¬¸ ì§ˆë¬¸ì„ ê°€ì ¸ì˜¤ëŠ” ì„œë¹„ìŠ¤ ë¡œì§\r\n */\r\n@Service\r\n@RequiredArgsConstructor\r\npublic class QuestionService {\r\n\r\n    private final QuestionRepository questionRepository;\r\n    private final UserSelectedTopicsRepository userSelectedTopicsRepository;\r\n\r\n    /**\r\n     * âœ… ëª¨ë“  ì§ˆë¬¸ ì¡°íšŒ\r\n     */\r\n    @Transactional(readOnly = true)\r\n    public List<Question> getAllQuestions() {\r\n        return questionRepository.findAll();\r\n    }\r\n\r\n    /**\r\n     * âœ… íŠ¹ì • ì§ˆë¬¸ IDë¡œ ì§ˆë¬¸ ì¡°íšŒ\r\n     */\r\n    @Transactional(readOnly = true)\r\n    public Optional<Question> getQuestionById(Long questionId) {\r\n        return questionRepository.findById(questionId);\r\n    }\r\n\r\n    /**\r\n     * âœ… ë¬´ë£Œ ë¬¸ì§„ (surveyId ê¸°ì¤€ ì§ˆë¬¸ & ì„ íƒì§€ ì¡°íšŒ)\r\n     */\r\n    @Transactional(readOnly = true)\r\n    public List<QuestionDTO> getFreeSurveyQuestions(Long surveyId) {\r\n        List<Question> questions = questionRepository.findBySurvey_SurveyId(surveyId);\r\n        return questions.stream().map(QuestionDTO::fromEntity).collect(Collectors.toList());\r\n    }\r\n\r\n    /**\r\n     * âœ… ìœ ë£Œ ë¬¸ì§„ (ìœ ì €ê°€ ì„ íƒí•œ ì£¼ì œ ê¸°ë°˜ ì§ˆë¬¸ & ì„ íƒì§€ ì¡°íšŒ)\r\n     */\r\n    @Transactional(readOnly = true)\r\n    public List<QuestionDTO> getPaidSurveyQuestions(Long userId) {\r\n        List<UserSelectedTopics> selectedTopics = userSelectedTopicsRepository.findAllByMemberUserId(userId);\r\n        List<SurveyTopic> topics = selectedTopics.stream()\r\n                .map(UserSelectedTopics::getSurveyTopic)\r\n                .collect(Collectors.toList());\r\n\r\n        List<Question> questions = questionRepository.findBySurveyTopicIn(topics);\r\n        return questions.stream().map(QuestionDTO::fromEntity).collect(Collectors.toList());\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/withme_backend/src/main/java/com/javalab/student/service/QuestionService.java b/withme_backend/src/main/java/com/javalab/student/service/QuestionService.java
--- a/withme_backend/src/main/java/com/javalab/student/service/QuestionService.java	(revision 4c23bbfa1bdc093609d3bed8ac16badc47cca692)
+++ b/withme_backend/src/main/java/com/javalab/student/service/QuestionService.java	(date 1739462775697)
@@ -1,9 +1,7 @@
 package com.javalab.student.service;
 
-import com.javalab.student.dto.ChoiceDTO;
 import com.javalab.student.dto.QuestionDTO;
 import com.javalab.student.entity.Question;
-import com.javalab.student.entity.SurveyTopic;
 import com.javalab.student.entity.UserSelectedTopics;
 import com.javalab.student.repository.QuestionRepository;
 import com.javalab.student.repository.UserSelectedTopicsRepository;
@@ -16,52 +14,62 @@
 import java.util.stream.Collectors;
 
 /**
- * ğŸ“Œ ì§ˆë¬¸ ì„œë¹„ìŠ¤ (ë¬´ë£Œ & ìœ ë£Œ ë¬¸ì§„)
- * - ì„¤ë¬¸ ì§ˆë¬¸ì„ ê°€ì ¸ì˜¤ëŠ” ì„œë¹„ìŠ¤ ë¡œì§
+ * ğŸ“Œ ì§ˆë¬¸ ì„œë¹„ìŠ¤
+ * ì„¤ë¬¸ì— í¬í•¨ëœ ê° ì§ˆë¬¸ì— ëŒ€í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ì²˜ë¦¬í•˜ëŠ” ì„œë¹„ìŠ¤ í´ë˜ìŠ¤
  */
 @Service
-@RequiredArgsConstructor
+@RequiredArgsConstructor  // âœ… ìƒì„±ì ì£¼ì… ìë™ ìƒì„±
 public class QuestionService {
 
     private final QuestionRepository questionRepository;
-    private final UserSelectedTopicsRepository userSelectedTopicsRepository;
+    private final UserSelectedTopicsRepository userSelectedTopicsRepository; // âœ… ìœ ë£Œ ë¬¸ì§„ì„ ìœ„í•œ Repository ì¶”ê°€
 
     /**
-     * âœ… ëª¨ë“  ì§ˆë¬¸ ì¡°íšŒ
+     * âœ… ëª¨ë“  ì§ˆë¬¸ ì¡°íšŒ (ì„ íƒì§€ í¬í•¨)
      */
     @Transactional(readOnly = true)
-    public List<Question> getAllQuestions() {
-        return questionRepository.findAll();
+    public List<QuestionDTO> getAllQuestions() {
+        return questionRepository.findAll().stream()
+                .map(QuestionDTO::fromEntity)
+                .collect(Collectors.toList());
     }
 
     /**
-     * âœ… íŠ¹ì • ì§ˆë¬¸ IDë¡œ ì§ˆë¬¸ ì¡°íšŒ
+     * âœ… ì§ˆë¬¸ IDë¡œ ì§ˆë¬¸ ì¡°íšŒ (ì„ íƒì§€ í¬í•¨)
      */
     @Transactional(readOnly = true)
-    public Optional<Question> getQuestionById(Long questionId) {
-        return questionRepository.findById(questionId);
+    public Optional<QuestionDTO> getQuestionById(Long questionId) {
+        return questionRepository.findById(questionId)
+                .map(QuestionDTO::fromEntity);
     }
 
     /**
-     * âœ… ë¬´ë£Œ ë¬¸ì§„ (surveyId ê¸°ì¤€ ì§ˆë¬¸ & ì„ íƒì§€ ì¡°íšŒ)
+     * âœ… íŠ¹ì • ì„¤ë¬¸ IDì— í•´ë‹¹í•˜ëŠ” ì§ˆë¬¸ ì¡°íšŒ (ë¬´ë£Œ ë¬¸ì§„)
+     * ì§ˆë¬¸ê³¼ ì„ íƒì§€ë¥¼ í•¨ê»˜ ë°˜í™˜í•˜ë„ë¡ ìˆ˜ì •
      */
     @Transactional(readOnly = true)
     public List<QuestionDTO> getFreeSurveyQuestions(Long surveyId) {
-        List<Question> questions = questionRepository.findBySurvey_SurveyId(surveyId);
-        return questions.stream().map(QuestionDTO::fromEntity).collect(Collectors.toList());
+        return questionRepository.findBySurvey_SurveyIdAndSurvey_Type(surveyId, "FREE").stream()
+                .map(QuestionDTO::fromEntity)
+                .collect(Collectors.toList());
     }
 
     /**
-     * âœ… ìœ ë£Œ ë¬¸ì§„ (ìœ ì €ê°€ ì„ íƒí•œ ì£¼ì œ ê¸°ë°˜ ì§ˆë¬¸ & ì„ íƒì§€ ì¡°íšŒ)
+     * âœ… íŠ¹ì • userIdì— í•´ë‹¹í•˜ëŠ” ìœ ë£Œ ë¬¸ì§„ ì§ˆë¬¸ ë¦¬ìŠ¤íŠ¸ ë°˜í™˜ (ì„ íƒì§€ í¬í•¨)
      */
     @Transactional(readOnly = true)
-    public List<QuestionDTO> getPaidSurveyQuestions(Long userId) {
-        List<UserSelectedTopics> selectedTopics = userSelectedTopicsRepository.findAllByMemberUserId(userId);
-        List<SurveyTopic> topics = selectedTopics.stream()
-                .map(UserSelectedTopics::getSurveyTopic)
+    public List<QuestionDTO> getPaidQuestionsByUserId(Long userId) {
+        // âœ… ìœ ì €ê°€ ì„ íƒí•œ ì£¼ì œ ëª©ë¡ ì¡°íšŒ
+        List<UserSelectedTopics> selectedTopics = userSelectedTopicsRepository.findAllByMember_Id(userId);
+
+        // âœ… ì„ íƒí•œ ì£¼ì œì˜ ID ëª©ë¡ ì¶”ì¶œ
+        List<Long> topicIds = selectedTopics.stream()
+                .map(topic -> topic.getSurveyTopic().getTopicId())
                 .collect(Collectors.toList());
 
-        List<Question> questions = questionRepository.findBySurveyTopicIn(topics);
-        return questions.stream().map(QuestionDTO::fromEntity).collect(Collectors.toList());
+        // âœ… ì„ íƒí•œ ì£¼ì œì— í•´ë‹¹í•˜ëŠ” ì§ˆë¬¸ ëª©ë¡ ì¡°íšŒ
+        return questionRepository.findBySurveyTopic_TopicIdIn(topicIds).stream()
+                .map(QuestionDTO::fromEntity)
+                .collect(Collectors.toList());
     }
-}
+}
\ No newline at end of file
Index: withme_backend/src/main/java/com/javalab/student/repository/QuestionRepository.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.javalab.student.repository;\r\n\r\nimport com.javalab.student.entity.Question;\r\nimport com.javalab.student.entity.SurveyTopic;\r\nimport org.springframework.data.jpa.repository.JpaRepository;\r\nimport org.springframework.stereotype.Repository;\r\n\r\nimport java.util.List;\r\n\r\n/**\r\n * ì§ˆë¬¸ Repository\r\n * Question ì—”í‹°í‹°ì— ëŒ€í•œ CRUD ì‘ì—…ì„ ì²˜ë¦¬í•˜ëŠ” ë¦¬í¬ì§€í† ë¦¬\r\n */\r\n@Repository\r\npublic interface QuestionRepository extends JpaRepository<Question, Long> {\r\n\r\n    /**\r\n     * âœ… íŠ¹ì • ì„¤ë¬¸ IDì— ì†í•œ ì§ˆë¬¸ ì¡°íšŒ (ë¬´ë£Œ ë¬¸ì§„)\r\n     */\r\n    List<Question> findBySurvey_SurveyId(Long surveyId);\r\n\r\n    /**\r\n     * âœ… íŠ¹ì • ìœ ì €ê°€ ì„ íƒí•œ ì£¼ì œì— ì†í•œ ì§ˆë¬¸ ì¡°íšŒ (ìœ ë£Œ ë¬¸ì§„)\r\n     */\r\n    List<Question> findBySurveyTopicIn(List<SurveyTopic> topics);\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/withme_backend/src/main/java/com/javalab/student/repository/QuestionRepository.java b/withme_backend/src/main/java/com/javalab/student/repository/QuestionRepository.java
--- a/withme_backend/src/main/java/com/javalab/student/repository/QuestionRepository.java	(revision 4c23bbfa1bdc093609d3bed8ac16badc47cca692)
+++ b/withme_backend/src/main/java/com/javalab/student/repository/QuestionRepository.java	(date 1739462804508)
@@ -1,8 +1,9 @@
 package com.javalab.student.repository;
 
 import com.javalab.student.entity.Question;
-import com.javalab.student.entity.SurveyTopic;
+import org.springframework.data.jpa.repository.EntityGraph;
 import org.springframework.data.jpa.repository.JpaRepository;
+import org.springframework.data.jpa.repository.Query;
 import org.springframework.stereotype.Repository;
 
 import java.util.List;
@@ -15,12 +16,18 @@
 public interface QuestionRepository extends JpaRepository<Question, Long> {
 
     /**
-     * âœ… íŠ¹ì • ì„¤ë¬¸ IDì— ì†í•œ ì§ˆë¬¸ ì¡°íšŒ (ë¬´ë£Œ ë¬¸ì§„)
+     * âœ… íŠ¹ì • ì„¤ë¬¸ IDì™€ ì„¤ë¬¸ íƒ€ì…ìœ¼ë¡œ ì§ˆë¬¸ ì¡°íšŒ (ë¬´ë£Œ ë¬¸ì§„)
+     * ì„ íƒì§€(choices)ë„ í•¨ê»˜ ê°€ì ¸ì˜¤ë„ë¡ LEFT JOIN FETCH ì ìš©
      */
-    List<Question> findBySurvey_SurveyId(Long surveyId);
+    @Query("SELECT DISTINCT q FROM Question q LEFT JOIN FETCH q.choices WHERE q.survey.surveyId = :surveyId AND q.survey.type = :surveyType")
+    List<Question> findBySurvey_SurveyIdAndSurvey_Type(Long surveyId, String surveyType);
 
     /**
-     * âœ… íŠ¹ì • ìœ ì €ê°€ ì„ íƒí•œ ì£¼ì œì— ì†í•œ ì§ˆë¬¸ ì¡°íšŒ (ìœ ë£Œ ë¬¸ì§„)
+     * âœ… íŠ¹ì • ì£¼ì œ(SurveyTopic)ì— í•´ë‹¹í•˜ëŠ” ì§ˆë¬¸ ì¡°íšŒ (ìœ ë£Œ íšŒì› ë¬¸ì§„)
+     * ì„ íƒì§€(choices)ë„ í•¨ê»˜ ê°€ì ¸ì˜¤ë„ë¡ LEFT JOIN FETCH ì ìš©
      */
-    List<Question> findBySurveyTopicIn(List<SurveyTopic> topics);
+    @Query("SELECT DISTINCT q FROM Question q LEFT JOIN FETCH q.choices WHERE q.surveyTopic.topicId IN :topicIds")
+    List<Question> findBySurveyTopic_TopicIdIn(List<Long> topicIds);
+
+
 }
\ No newline at end of file
